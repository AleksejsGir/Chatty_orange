# 📁 Структура проекта Chatty Orange

В этом документе представлена полная структура проекта Chatty Orange - социальной сети на Django. Четкое понимание организации файлов и каталогов поможет быстрее ориентироваться в проекте и соблюдать его архитектуру при разработке.

## 📑 Актуальная структура каталогов и файлов

```
Chatty_orange/                        # Корневой каталог проекта
│
├── Chatty_orange/                    # Основное приложение (core)
│   ├── __init__.py
│   ├── asgi.py                       # ASGI конфигурация
│   ├── settings/                     # Модульная структура настроек
│   │   ├── __init__.py
│   │   ├── base.py                   # Базовые настройки для всех окружений
│   │   ├── development.py            # Настройки для разработки
│   │   └── production.py             # Настройки для продакшена
│   ├── urls.py                       # Главные URL маршруты
│   └── wsgi.py                       # WSGI конфигурация
│
├── users/                            # Приложение для пользователей
│   ├── __init__.py
│   ├── adapters.py                   # Адаптеры для django-allauth
│   ├── admin.py                      # Настройки админки для пользователей
│   ├── apps.py                       # Конфигурация приложения
│   ├── forms.py                      # Формы для профиля пользователя
│   ├── migrations/                   # Миграции БД для пользователей
│   │   ├── 0001_initial.py           # Начальная миграция
│   │   └── __init__.py
│   ├── models.py                     # Модель пользователя с аватаром, био
│   ├── templates/                    # Шаблоны внутри приложения users
│   │   └── users/                    # Папка с именем приложения
│   │       ├── profile.html          # Профиль пользователя
│   │       └── profile_edit.html     # Редактирование профиля
│   ├── urls.py                       # URL для пользователей
│   └── views.py                      # Представления для профиля
│
├── posts/                            # Приложение для постов
│   ├── __init__.py
│   ├── admin.py                      # Настройки админки для постов
│   ├── apps.py                       # Конфигурация приложения
│   ├── forms.py                      # Формы для постов
│   ├── migrations/                   # Миграции БД для постов
│   │   └── __init__.py
│   ├── models.py                     # Модели поста, комментария, лайка, тега
│   ├── templates/                    # Шаблоны внутри приложения posts
│   │   └── posts/                    # Папка с именем приложения
│   │       ├── comment.html          # Шаблон для отображения комментария
│   │       ├── comment_confirm_delete.html # Подтверждение удаления комментария
│   │       ├── components/           # Компоненты интерфейса
│   │       │   └── back_button.html  # Кнопка "Назад"
│   │       ├── post_confirm_delete.html   # Подтверждение удаления поста
│   │       ├── post_detail.html      # Детальный просмотр поста
│   │       ├── post_form.html        # Форма создания/редактирования поста
│   │       ├── post_list.html        # Список постов
│   │       ├── privacy_policy.html   # Политика конфиденциальности
│   │       └── terms_of_use.html     # Условия использования
│   ├── templatetags/                 # Кастомные теги шаблонов
│   │   ├── __init__.py
│   │   ├── back_button.py            # Тег для кнопки "Назад"
│   │   ├── highlight.py              # Тег подсветки текста
│   │   └── highlight_tags.py         # Тег подсветки тегов
│   ├── urls.py                       # URL для постов
│   └── views.py                      # Представления для работы с постами
│
├── subscriptions/                    # Приложение для подписок
│   ├── __init__.py
│   ├── admin.py                      # Настройки админки для подписок
│   ├── apps.py                       # Конфигурация приложения
│   ├── migrations/                   # Миграции БД для подписок
│   │   ├── 0001_initial.py           # Начальная миграция
│   │   ├── 0002_alter_subscription_created_at.py # Изменение поля даты
│   │   └── __init__.py
│   ├── models.py                     # Модель подписки
│   ├── templates/                    # Шаблоны внутри приложения subscriptions
│   │   └── subscriptions/            # Папка с именем приложения
│   │       ├── feed.html             # Лента подписок
│   │       ├── followers.html        # Список подписчиков
│   │       └── following.html        # Список подписок
│   ├── urls.py                       # URL для подписок
│   └── views.py                      # Представления для подписок
│
├── orange_assistant/                 # 🍊 Приложение ИИ-помощника
│   ├── __init__.py
│   ├── admin.py                      # Настройки админки (если нужны)
│   ├── ai_services.py                # 🧠 Основная логика работы с ИИ
│   ├── apps.py                       # Конфигурация приложения
│   ├── migrations/                   # Миграции БД (если есть модели)
│   │   └── __init__.py
│   ├── models.py                     # Модели для ИИ (если нужны)
│   ├── templates/                    # Шаблоны ИИ-помощника
│   │   └── orange_assistant/         # Папка с именем приложения
│   │       ├── assistant_components.html # 🎨 Компоненты интерфейса ИИ
│   │       └── home.html             # Главная страница с ИИ
│   ├── tests.py                      # Тесты для ИИ-помощника
│   ├── urls.py                       # URL для API ИИ-помощника
│   └── views.py                      # 🌐 Представления для обработки запросов к ИИ
│
├── static/                           # Статические файлы
│   ├── css/                          # CSS файлы
│   │   ├── orange-assistant.css      # 🎨 Стили для ИИ-помощника
│   │   ├── orange-style.css          # Основные стили проекта
│   │   ├── post-images.css           # Стили для изображений в постах
│   │   ├── search-styles.css         # Стили для поиска
│   │   └── unified-styles.css        # Объединенные стили
│   ├── images/                       # Изображения проекта
│   └── js/                           # JavaScript файлы
│       ├── likes.js                  # Скрипт для функционала лайков
│       ├── orange-assistant.js       # 🤖 Скрипт для ИИ-помощника
│       └── subscriptions.js          # Скрипт для функционала подписок
│
├── templates/                        # Глобальные шаблоны проекта
│   ├── account/                      # Шаблоны для django-allauth
│   │   ├── account_inactive.html     # Неактивный аккаунт
│   │   ├── email.html                # Email шаблон
│   │   ├── email_confirm.html        # Подтверждение email
│   │   ├── email_confirmation_done.html # Email подтвержден
│   │   ├── login.html                # Вход в систему
│   │   ├── logout.html               # Выход из системы
│   │   ├── password_reset.html       # Сброс пароля
│   │   ├── password_reset_done.html  # Подтверждение сброса пароля
│   │   ├── password_reset_from_key.html # Форма нового пароля
│   │   ├── password_reset_from_key_done.html # Успешный сброс пароля
│   │   ├── signup.html               # Регистрация
│   │   └── verification_sent.html    # Отправлено подтверждение
│   ├── socialaccount/                # Шаблоны для социальной авторизации
│   │   ├── authentication_error.html # Ошибка авторизации
│   │   ├── connections.html          # Подключения соцсетей
│   │   ├── login.html                # Вход через соцсети
│   │   ├── login_cancelled.html      # Отмена входа
│   │   └── signup.html               # Регистрация через соцсети
│   ├── base.html                     # Базовый шаблон
│   ├── home.html                     # Главная страница
│   ├── includes/                     # Включаемые компоненты
│   │   ├── footer.html               # Футер
│   │   └── navbar.html               # Навигационная панель
│   ├── privacy_policy.html           # Политика конфиденциальности
│   └── terms_of_use.html             # Условия использования
│
├── tests/                            # 🧪 Централизованные тесты
│   ├── __init__.py
│   ├── conftest.py                   # Конфигурация pytest
│   ├── factories.py                  # Фабрики для создания тестовых данных
│   ├── test_forms/                   # Тесты форм
│   │   ├── __init__.py
│   │   ├── test_post_forms.py        # Тесты форм постов
│   │   └── test_user_forms.py        # Тесты пользовательских форм
│   ├── test_integration/             # Интеграционные тесты
│   │   ├── __init__.py
│   │   └── test_user_flows.py        # Тесты пользовательских сценариев
│   ├── test_models/                  # Тесты моделей
│   │   ├── __init__.py
│   │   ├── test_post_models.py       # Тесты моделей постов
│   │   ├── test_subscription_models.py # Тесты моделей подписок
│   │   └── test_user_models.py       # Тесты пользовательских моделей
│   └── test_views/                   # Тесты представлений
│       ├── __init__.py
│       ├── test_post_views.py        # Тесты представлений постов
│       ├── test_subscription_views.py # Тесты представлений подписок
│       └── test_user_views.py        # Тесты пользовательских представлений
│
├── certbot/                          # Конфигурация для SSL-сертификатов
│   └── www/                          # Директория для подтверждения домена
│
├── nginx/                            # Конфигурация Nginx
│   ├── conf.d/                       # Конфигурационные файлы сайтов
│   └── ssl/                          # SSL-сертификаты
│
├── htmlcov/                          # 📊 Отчеты о покрытии тестами
│
├── conftest.py                       # Глобальная конфигурация pytest
├── manage.py                         # Скрипт управления проектом
└── requirements.txt                  # Зависимости Python
```

## 🔍 Основные компоненты проекта

### Ядро приложения

- **Chatty_orange/** - Центральный модуль Django-проекта, содержащий основные настройки и конфигурацию.
  - `settings/` - Модульные настройки, разделенные на базовые, разработочные и продакшн
  - `urls.py` - Корневые URL-маршруты, объединяющие URL из всех приложений

### Приложения

- **users/** - Отвечает за аутентификацию и управление пользователями
  - `adapters.py` - Адаптеры для интеграции с django-allauth
- **posts/** - Отвечает за создание, отображение и взаимодействие с постами
  - `templatetags/` - Кастомные теги шаблонов для подсветки и навигации
- **subscriptions/** - Управляет подписками на пользователей и лентой подписок
- **orange_assistant/** - 🍊 **ИИ-помощник**: интеграция с Google Gemini API для умного взаимодействия с пользователями

### 🤖 Детализация ИИ-помощника (orange_assistant/)

**Ключевые файлы:**
- **ai_services.py** - Основная бизнес-логика:
  - Функции поиска постов и пользователей
  - Интеграция с Google Gemini API
  - Генерация персонализированных рекомендаций
  - Обработка различных типов запросов пользователей

- **views.py** - API-представления:
  - `ChatWithAIView` - обработка AJAX-запросов от чата
  - Определение типа команды пользователя
  - Маршрутизация запросов к соответствующим функциям
  - Возврат JSON-ответов для frontend

- **templates/orange_assistant/** - Шаблоны ИИ:
  - `assistant_components.html` - Компоненты интерфейса (модальные окна, чат-виджет)
  - `home.html` - Возможно, специальная главная страница с демо ИИ

**Frontend-компоненты:**
- **orange-assistant.js** - Клиентская логика:
  - Создание и управление чат-виджетом
  - AJAX-запросы к backend
  - Сохранение истории в localStorage
  - Обработка пользовательского интерфейса

- **orange-assistant.css** - Стилизация:
  - Фиксированный виджет в правом нижнем углу
  - Адаптивный дизайн для мобильных устройств
  - Анимации и переходы

### Кастомные теги шаблонов (posts/templatetags/)

- **highlight.py** - Подсветка текста в результатах поиска
- **highlight_tags.py** - Подсветка тегов в контенте
- **back_button.py** - Универсальная кнопка возврата

### Шаблоны

В проекте применяется двухуровневая организация шаблонов:
1. **templates/** - Общие шаблоны для всего проекта:
   - `base.html` - Базовый шаблон с общей структурой HTML
   - `includes/` - Переиспользуемые компоненты (навигация, футер)
   - `account/` - Полный набор шаблонов для django-allauth
   - `socialaccount/` - Шаблоны для социальной авторизации

2. **app_name/templates/app_name/** - Шаблоны внутри каждого приложения:
   - Следует стандартной Django-практике двойного вложения 
   - Обеспечивает модульность и избегание конфликтов имен
   - **posts/** включает подпапку `components/` для переиспользуемых элементов

### Статические файлы

- **static/css/** - Специализированные стили:
  - `orange-assistant.css` - Стили для ИИ-помощника
  - `orange-style.css` - Основные стили проекта
  - `post-images.css` - Стили для отображения изображений
  - `search-styles.css` - Стили для функций поиска
  - `unified-styles.css` - Объединенные стили

- **static/js/** - JavaScript-функциональность:
  - `orange-assistant.js` - Логика ИИ-чата
  - `likes.js` - AJAX для лайков
  - `subscriptions.js` - AJAX для подписок

### Тестирование

- **tests/** - Централизованная структура тестов:
  - Организована по типам (модели, представления, формы, интеграция)
  - Использует pytest с фабриками для создания тестовых данных
  - **htmlcov/** - Отчеты о покрытии кода HTML-формате
  - **conftest.py** - Глобальная конфигурация pytest

### Инфраструктура

- **certbot/** - Настройки для получения и обновления SSL-сертификатов
- **nginx/** - Настройки веб-сервера для продакшн-окружения

## 📋 Рекомендации по работе со структурой

1. **Модульность**: Сохраняйте логическое разделение кода между приложениями. Если функционал относится к пользователям, размещайте его в приложении `users`.

2. **ИИ-помощник**: 
   - Вся логика работы с ИИ должна находиться в `orange_assistant/ai_services.py`
   - Frontend-логика - в `static/js/orange-assistant.js`
   - Компоненты интерфейса - в `orange_assistant/templates/orange_assistant/`
   - Для добавления новых команд ИИ расширяйте функции в `ai_services.py`

3. **Настройки**: Используйте модульную структуру настроек:
   - `base.py` - общие настройки для всех окружений
   - `development.py` - настройки для локальной разработки
   - `production.py` - настройки для продакшн-сервера
   - **Обязательно**: добавьте `GOOGLE_API_KEY` в переменные окружения

4. **Кастомные теги**: 
   - Размещайте в `posts/templatetags/` для логики, связанной с отображением контента
   - Регистрируйте теги с понятными именами
   - Документируйте функциональность в docstrings

5. **Шаблоны**: 
   - Соблюдайте двойное вложение для шаблонов в приложениях (`app_name/templates/app_name/`)
   - Используйте подпапки `components/` для переиспользуемых элементов
   - ИИ-компоненты размещайте в собственном приложении

6. **URL-маршруты**: Определяйте URL в каждом приложении и включайте их в корневой `urls.py`.

7. **Тестирование**: 
   - Используйте централизованную структуру `tests/`
   - Для ИИ-помощника создавайте мок-объекты для API Google Gemini
   - Проверяйте покрытие с помощью `htmlcov/`
   - Используйте фабрики из `tests/factories.py`

8. **JavaScript-взаимодействие**: 
   - Для функциональности, требующей AJAX, используйте отдельные JS файлы
   - Размещайте их в `static/js/` с понятными именами
   - **ИИ-помощник**: используйте `localStorage` для сохранения состояния чата

9. **CSS-организация**:
   - Используйте специализированные файлы для разных компонентов
   - `unified-styles.css` для общих стилей
   - Отдельные файлы для сложных компонентов (ИИ, изображения, поиск)

10. **Безопасность**:
    - Обеспечьте CSRF-защиту для всех AJAX-запросов
    - API ключи храните в переменных окружения
    - Валидируйте пользовательский ввод перед отправкой к ИИ

## 🔧 Специфические требования для ИИ-помощника

### Переменные окружения:
```bash
# В .env или .env.prod
GOOGLE_API_KEY=your_google_gemini_api_key_here
```

### Зависимости:
```
google-generativeai>=0.3.0
importlib-metadata==4.11.4
```

### Основные функции AI Services:
- `find_post_by_keyword()` - поиск постов
- `find_user_by_username()` - поиск пользователей  
- `get_subscription_recommendations()` - рекомендации авторов
- `check_post_content()` - проверка контента
- `get_gemini_response()` - базовое взаимодействие с ИИ

### Интеграция с проектом:
- Компоненты ИИ подключаются через `assistant_components.html`
- AJAX-запросы направляются на `/assistant/api/chat/`
- История чата сохраняется в localStorage по пользователям

Эта структура обеспечивает масштабируемость, безопасность и удобство разработки современной социальной сети с интеграцией искусственного интеллекта.